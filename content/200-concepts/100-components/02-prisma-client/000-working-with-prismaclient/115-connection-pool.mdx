---
title: Connection pool
metaDescription: Prisma's query engine creates a connection pool to store and manage database connections.
tocDepth: 2
---

<TopBlock>

The query engine manages a **connection pool** of database connections. The connection pool is created when the first connection to the database is opened - either by [explicitly calling `$connect()`](connection-management#connect) or by running the first query.

</TopBlock>

## How the connection pool works

The following steps describe how the connection pool handles incoming queries:

1. The query engine instantiates a connection pool with a [congfigurable pool size]() and [pool timeout]().
1. The query engine reserves connections from the pool and processes queries.
1. If the query engine cannot reserve a connection in the pool, queries are added to a FIFO (First In First Out) queue in memory.

  > **Note**: FIFO means that queries are processed in the order they enter the queue.

1. If the query engine cannot check out a connection before the pool timeout, it throws an exception with error code `P2024`.

### Optimum throughput

    * Many users accessing your app simultaneously
    * You run many queries in parallel (for example, with `Promise.all()`)

## Connection limit

### Default connection limit

The default number of connections (pool size) is calculated with the following formula:

```bash
num_physical_cpus * 2 + 1
```

`num_physical_cpus` represents the number of physical CPUs on your machine. If your machine has **four** physical CPUs, your connection pool will contain **nine** connections (`4 * 2 + 1 = 9`).

### Setting the connection limit

You can specify the number of connections by explicitly setting the `connection_limit` parameter in your database connection URL. For example, with the following `datasource` configuration in your [Prisma schema](../../prisma-schema) the connection pool will have exactly five connections:

```prisma
datasource db {
  provider = "postgresql"
  url      = "postgresql://johndoe:mypassword@localhost:5432/mydb?connection_limit=5"
}
```

## Connection pool timeout

TODO

### Setting the connection pool timeout

You can specify the pool timeout explicitly setting the `pool_timeout` parameter in your database connection URL. In the following example, the pool times out after 2 seconds:

```prisma
datasource db {
  provider = "postgresql"
  url      = "postgresql://johndoe:mypassword@localhost:5432/mydb?connection_limit=5&pool_timeout=2"
}
```

## Recommended connection limit

The [default connection pool size](#default-connection-pool-size) represents a good starting point that can be tuned with testing.

TODO: For example, many parallel queries (and you send 1000 queries to prisma without awaiting them) - may get a timeout issue. First solution is to increase connection pool size.

Your deployment paradigm also affects the recommended connection limit - for example, [in some serverless environments, it makes sense to set the connection limit to `1`]() <span class="guide"></span>.

## External connection poolers

In serverless environments, you might end up with 3000 concurrently running functions - even if _each_ instance has a `connection_limit` of `1`. Limit concurrency or set up a connection pooler like pgBouncer.